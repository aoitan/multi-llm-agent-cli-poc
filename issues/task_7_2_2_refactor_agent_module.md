# タスク 7.2.2: agent.ts の責務分割とユーティリティ化

## 概要
`src/agent.ts` に集中しているエージェント生成、ワークフロー制御、テンプレート処理、言語ガードなどの責務を、それぞれ専用モジュールへ分割し再利用性を高める。

## 目的
モジュール粒度を適正化し、DRY 原則・SRP に沿った構造へ改修することで、将来の機能追加やテストを容易にする。

## 受け入れ条件
- [ ] `Agent` クラス、言語ガード、テンプレート処理などが別ファイルに抽出され、`agent.ts` (または新しいエントリーポイント) はワークフロー調整に専念している。
- [ ] 抽出したモジュールに対する単体テストが追加され、主要ロジックがカバーされている。
- [ ] 重複するコード (プロンプトロード、ログ出力など) が共通ユーティリティへ整理されている。
- [ ] リファクタ後も既存テスト (`npm test`) がすべて成功する。

## 作業手順
1. [ ] 現行 `agent.ts` の責務を棚卸しし、モジュール境界を決める。
2. [ ] 言語ガードやテンプレート処理を小さな関数・クラスへ抽出し、必要な依存ユーティリティを注入可能にする。
3. [ ] 新たに追加したモジュールに対応する単体テストを実装する。
4. [ ] `npm test` を実行し、全テストがグリーンであることを確認する。

## 検証 / テスト
- `npm test`
- 必要に応じて `npm test -- --coverage` でカバレッジ確認

## アウトプット
- 新たに追加されたモジュール (`src/agents/`, `src/workflow/` など)
- 更新されたエントリーポイント (`agent.ts` など)
- 追加されたテストコード

## 関連情報
- ストーリー 7.1 で再整備するテストスイート
- `src/utils` 配下の既存ユーティリティ
