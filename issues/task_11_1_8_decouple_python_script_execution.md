
# Task: Pythonスクリプト間の連携方法の改善

## 概要

`subprocess` 呼び出しや一時ファイル (`current_run_base_dir.txt`) を介したPythonスクリプト間の密結合な連携をリファクタリングし、より疎結合なコンポーネントベースのアーキテクチャに改善します。

## 背景

現在、`generate_reports.py` が `ab_test_runner.py` を `subprocess` で呼び出したり、複数のスクリプトが `current_run_base_dir.txt` という一時ファイルを介して状態を共有したりしています。このアプローチには以下の問題があります。

-   **テスト容易性の低下**: スクリプトを単体でテストすることが困難です。
-   **再利用性の欠如**: コアロジックがスクリプト実行の副作用と密接に結びついているため、他のコンテキストで再利用できません。
-   **可読性とメンテナンス性の悪化**: データフローが不明確で、処理の追跡が困難です。

このタスクは、これらのスクリプトをインポート可能な関数として再構築し、テストと再利用が容易な疎結合な構造を実現することを目的とします。

## 作業内容

1.  `ab_test_runner.py` と `prepare_evaluation.py` のコアロジックを、副作用のない純粋な関数として切り出します。
    -   例: `ab_test_runner.py` -> `run_ab_test(...)`
    -   例: `prepare_evaluation.py` -> `setup_evaluation_directory(...)`
2.  `generate_reports.py` を修正し、`subprocess` で `ab_test_runner.py` を呼び出す代わりに、`run_ab_test` 関数を直接インポートして使用するように変更します。
3.  `current_run_base_dir.txt` を介した状態共有を廃止します。スクリプト間で必要な情報（ベースディレクトリパスなど）は、関数の引数や戻り値を通じて明示的に渡すようにします。
4.  関連するスクリプトのエントリーポイント (`if __name__ == '__main__':`) を調整し、コマンドラインからの実行と他のモジュールからのインポートの両方をサポートするようにします。

## 完了条件

-   Pythonスクリプト間の `subprocess` 呼び出しが、関数インポートと直接呼び出しに置き換えられていること。
-   `current_run_base_dir.txt` を使用した状態共有が廃止されていること。
-   各スクリプトのコアロジックが、テスト可能な独立した関数としてカプセル化されていること。
