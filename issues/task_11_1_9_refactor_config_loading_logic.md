
# Task: 設定ファイル読み込みロジックの共通化

## 概要

TypeScriptアプリケーション内に点在する、各種設定ファイル（プロンプト、ワークフロー、一般設定）の読み込みと検証に関する重複したロジックを、汎用的なローダー関数に統合し、DRY原則を徹底します。

## 背景

現在、`promptLoader.ts`, `workflowLoader.ts`, `configLoader.ts` など、複数のファイルにわたって設定ファイルを読み込むための類似したコードが存在します。これらのコードは、ファイルの存在チェック、ファイル読み込み、JSONパース、スキーマ検証といった共通のステップを含んでおり、冗長性の原因となっています。

この重複は、将来的な変更（例: 新しい設定ファイルの追加、エラーハンドリングの改善）を困難にし、バグの温床となる可能性があります。

## 作業内容

1.  `src/utils` ディレクトリに、新しいユーティリティファイル（例: `jsonLoader.ts`）を作成します。
2.  このファイルに、汎用的なファイル読み込み・検証関数 `loadAndValidateJsonFile<T>(filePath: string, schemaValidator: (data: any) => T): Promise<T>` を実装します。この関数は以下の責務を担います。
    -   指定された `filePath` のファイル存在をチェックする。
    -   ファイルをUTF-8で読み込む。
    -   内容をJSONとしてパースする。
    -   引数として渡された `schemaValidator` 関数を用いて、パースしたオブジェクトのスキーマを検証する。
    -   検証済みのオブジェクトを型 `T` として返す。
    -   各ステップで発生したエラー（ファイル不在、JSON不正、スキーマ違反）に対して、一貫性のあるエラーハンドリングを提供する。
3.  既存のローダー (`loadPromptFile`, `loadWorkflowFile`, `loadConfigFile` など）をリファクタリングし、内部でこの新しい汎用関数 `loadAndValidateJsonFile` を呼び出すように変更します。各ローダーは、それぞれのスキーマ検証ロジックを `schemaValidator` として渡すことに専念します。

## 完了条件

-   ファイル読み込み、JSONパース、スキーマ検証のロジックが、単一の汎用的な関数に統合されていること。
-   既存のすべての設定ファイルローダーが、この汎用関数を利用してリファクタリングされていること。
-   コードの重複が排除され、各ローダーの責務がスキーマ定義に限定されていること。
