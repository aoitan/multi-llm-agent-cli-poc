# ストーリー 10.2: エージェント実装の責務分割と API 整合性確保

## 概要
協調ワークフローの復旧に伴い、400 行規模に肥大化した `src/agent.ts` を分割し、エージェント通信とワークフロー状態管理を独立したモジュールとして再構築します。

## 受け入れ条件
- [ ] `Agent` ラッパー、ワークフロー実行、テンプレート補完などの責務が明確に分割され、各モジュールに単体テストが付与されている。
- [ ] 既存 API (`orchestrateWorkflow`, `runEnsemble`, `fillTemplate`) の呼び出し元が移行され、挙動互換性が維持されている。
- [ ] ESLint / TypeScript ビルドで循環依存や未使用コードが発生しない。

## 進め方のガイド
- 先に抽出対象の関心ごとを洗い出し、小さな PR に分割できる構造を検討してください。
- ワークフロー状態管理は別ファイルへ切り出し、ステップ実行の副作用を明文化すると再利用しやすくなります。
- 新旧 API の差分をテストで担保し、`git blame` が活きるようファイル移動より抽出を優先してください。

## 関連タスク
* [ ] [タスク 10.2.1: agent.ts の責務分割とインフラテスト追加](task_10_2_1_split_agent_module_responsibilities.md)

## 依存関係 / リスク
- 並行作業がある場合、モジュール分割のコンフリクトに注意してください。
- `cooperativeAgentEval.ts` の復旧と同時に実施する場合、API シグネチャ変更を調整する必要があります。
