# エピック: ワークフロー信頼性とモジュール整備

## 概要
LLM ワークフロー実行系と周辺スクリプトに存在する信頼性・保守性の課題を解消し、テスト駆動の開発が進めやすい基盤を整えます。具体的には、本番設定ファイルを削除してしまうテストや、存在しない API 参照、責務肥大化したエージェントモジュール、JSON 出力が壊れる CLI スクリプトなどの問題を解決し、将来のエピック/ストーリーが安心して依存できる状態を作ります。

## 成功指標
- 主要ワークフローの自動テストが CI で安定実行でき、設定ファイル破壊などの副作用が発生しない。
- `src/agent.ts` の責務が分割され、モジュール構造がガイドラインに沿って再利用可能になっている。
- CLI / Python スクリプトの JSON モード出力が機械可読性を保ち、エラー時も仕様を満たす。

## 受け入れ条件
- [ ] 新設ストーリーの完了後、CI で `npm test` と Python 側のスクリプトテストが失敗なく通り、本番アセットを破壊しないことが検証されている。
- [ ] `src/agent.ts` から抽出した共通処理に対し単体テストが整備され、重複リストや分岐が可視化されている。
- [ ] CLI / スクリプトの JSON 実行パスで例外発生時に JSON 以外の文字列が標準出力に混入しないことがテストで保証されている。

## スコープ
- TypeScript ワークフロー実行モジュールと関連ユーティリティ
- Python ベースの A/B テスト / レポート生成スクリプト
- テストスイートと CI 対応手順

## 非スコープ
- 新規ワークフローやシナリオの追加
- モデル・プロンプトのロジック変更（再設計が必要な場合は別エピックで扱う）

## 関連ストーリー
* [ ] [ストーリー 7.1: テスト環境分離とワークフロー検証強化](story_7_1_test_isolation_and_workflow_validation.md)
* [ ] [ストーリー 7.2: エージェントモジュールの責務分割と API 整合性回復](story_7_2_agent_modularity_and_api_alignment.md)
* [ ] [ストーリー 7.3: CLI スクリプトの JSON 出力信頼性向上](story_7_3_cli_json_output_reliability.md)

## 関連資料
- `src/agent.ts` 現行実装
- `src/__tests__/scenarioIdentifier.test.ts`
- `scripts/ab_test_runner.py`, `scripts/generate_reports.py`
