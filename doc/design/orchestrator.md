# 統括・実行管理機能（オーケストレーター）設計書

## 概要

本機能は、ユーザーからの抽象的な指示を具体的な実行計画に落とし込み、エージェント群を指揮する役割を担う。これにより、複雑なタスクを複数のLLMエージェントが協調して遂行できるようになる。

## 主要機能

### 1. タスク分解・計画機能

- **目的**: 複雑なユーザープロンプトを、エージェントが実行可能なサブタスクのシーケンスや依存関係グラフに自動で変換する。
- **詳細**: 
    - ユーザープロンプトを解析し、必要なステップを特定する。
    - 各ステップを独立したサブタスクとして定義する。
    - サブタスク間の依存関係（例: サブタスクBはサブタスクAの完了後に実行可能）を構築する。
    - 実行計画（タスクグラフまたはシーケンス）を生成する。
- **入力**: ユーザープロンプト
- **出力**: タスクリスト、タスクグラフ、または実行シーケンス

### 2. タスク割り当て機能

- **目的**: 各サブタスクの性質に応じて、最も適した役割を持つエージェントに動的に割り当てる。
- **詳細**: 
    - 各エージェントの専門性（例: リサーチャー、プログラマー、レビュアー）を定義する。
    - サブタスクの内容を分析し、最適なエージェントを選択する。
    - 必要に応じて、複数のエージェントに並行してタスクを割り当てる（アンサンブル）。
- **入力**: サブタスク、利用可能なエージェントのリストと専門性
- **出力**: 各サブタスクに割り当てられたエージェント

### 3. 状態管理機能

- **目的**: プロジェクト全体の進捗、各タスクの成功・失敗、中間生成物を追跡し、プロセス全体の制御を行う。
- **詳細**: 
    - 各サブタスクのステータス（未開始、進行中、完了、失敗）を管理する。
    - 中間生成物（例: リサーチ結果、コードスニペット、レビューコメント）を保存し、後続のタスクやエージェントが参照できるようにする。
    - 失敗したタスクのリトライメカニズムや、エラーハンドリングの仕組みを導入する。
- **入力**: 各エージェントからのタスク実行結果、中間生成物
- **出力**: プロジェクトの現在の状態、進捗状況

## 実装方針

- オーケストレーターは独立したモジュールとして実装し、他のエージェントや機能との疎結合を保つ。
- タスク分解・計画には、LLM自身の推論能力を活用する（例: LLMにタスク分解を指示するプロンプトエンジニアリング）。
- 状態管理は、シンプルなデータ構造（JSONなど）でメモリ上に保持し、必要に応じて永続化する仕組みを検討する。

## 考慮事項

- 複雑なタスク分解の精度と、LLMの推論能力の限界。
- エージェント間の競合状態やデッドロックの回避。
- ユーザーへの進捗状況のフィードバック方法。
