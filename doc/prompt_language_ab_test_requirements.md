# プロンプト言語A/Bテストの要件

## 概要

LLMへの内部プロンプトの言語（日本語 vs 英語）が応答品質に与える影響を評価するためのA/Bテストの要件を定義する。LLMのトレーニングデータが主に英語である可能性を考慮し、言語によるパフォーマンスの違いを定量的に測定することを目的とする。

## 1. テスト対象プロンプトの特定と翻訳

*   **テスト対象プロンプトの特定:** `prompts/default_prompts.json` 内から、A/Bテストの対象とする内部プロンプト（例：システムプロンプト、ユーザープロンプトテンプレート）を特定する。
*   **プロンプトの翻訳:** 特定された日本語プロンプトに対して、高品質な英語翻訳を作成する。翻訳は、元のプロンプトの意図、ニュアンス、および技術的な正確性を完全に保持するように注意深く行う。
*   **プロンプトファイルの準備:** 翻訳された英語プロンプトを格納するための新しいJSONファイル（例：`prompts/english_prompts.json`）を作成する。このファイルの構造は、既存の `default_prompts.json` と互換性があるようにする。

## 2. A/Bテストの設定

既存のA/Bテストフレームワーク (`scripts/ab_test_runner.py` および `config/ab_test_config.json`) を活用し、言語による比較テストを可能にする。

*   **設定ファイルの更新:** `config/ab_test_config.json` に、プロンプト言語A/Bテストを制御するための新しい設定項目を追加する。
    *   例：`"prompt_language_test_enabled": true/false`
    *   例：`"base_prompt_file_japanese": "prompts/default_prompts.json"`
    *   例：`"experimental_prompt_file_english": "prompts/english_prompts.json"`
*   **`ab_test_runner.py` の適応:** `ab_test_runner.py` が、`ab_test_config.json` の設定に基づいて、テストグループごとに適切な言語のプロンプトファイルをロードしてLLMに渡せるように修正する。

## 3. 評価指標

プロンプト言語による応答品質の違いを測定するための評価指標を設定する。動的プロンプトテストの評価指標と共通する部分が多いが、言語特有の側面も考慮する。

*   **定量的指標:**
    *   **タスク完了率:** 特定のタスクがどれだけ正確に完了したか。
    *   **応答の長さ/簡潔さ:** 応答が適切に簡潔であるか。
    *   **特定のキーワード/フレーズの出現率:** 応答に特定の必須キーワードやフレーズが含まれているか（言語ごとに適切なキーワードを設定）。
    *   **構造化された出力の正確性:** JSONなどの構造化された出力が、定義されたスキーマにどれだけ準拠しているか。
    *   **LLMの応答速度:** 言語による処理速度の違いがあるか。
*   **定性的な指標 (手動評価):**
    *   **関連性:** 応答がユーザーの意図にどれだけ関連しているか。
    *   **正確性:** 応答に含まれる情報がどれだけ正確か。
    *   **自然さ/流暢さ:** 応答の言語が自然で流暢であるか（特に日本語プロンプトの場合）。
    *   **一貫性:** 応答全体で論理的な一貫性が保たれているか。
    *   **理解度:** LLMがプロンプトの意図をどれだけ正確に理解しているか。

## 4. 作業手順の概要

1.  **テスト対象プロンプトの選定と翻訳:** `default_prompts.json` からテストしたいプロンプトを選び、英語に翻訳して `english_prompts.json` を作成する。
2.  **A/Bテスト設定の更新:** `ab_test_config.json` に言語テスト用の設定を追加する。
3.  **`ab_test_runner.py` の修正:** 設定に基づいてプロンプトファイルを切り替えるロジックを実装する。
4.  **評価スクリプトの更新:** `generate_reports.py` を更新し、言語テストの結果を分析・比較できるレポートを生成できるようにする。
5.  **テストの実行と評価:** A/Bテストを実行し、定義された指標に基づいて結果を分析する。
