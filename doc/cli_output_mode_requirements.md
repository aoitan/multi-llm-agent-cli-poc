# CLI出力モード要件定義

## 1. 目的

CLIアプリケーションの出力形式を柔軟に制御し、人間可読性と機械可読性（JSON）の両方に対応することで、ユーザー体験とプログラム連携の利便性を向上させる。

## 2. スコープ

*   CLIアプリケーションの標準出力。
*   エラー出力はスコープ外とする（従来通り標準エラー出力）。

## 3. 機能要件

### 3.1. デフォルト出力モード

*   引数なしでCLIを実行した場合、人間が読みやすい形式で情報を出力する。
*   出力内容は、ユーザーへの情報提供を主目的とする。
*   **会話の区切りはMarkdownの見出し（例: `# ターン 1`）で区切る。**
*   **LLMの出力に続くモデル名や出力時間などのメタデータは、LLMの出力本体と明確に区切って表示する。**
*   例: 処理の進捗、最終結果のサマリー、対話ログの整形表示など。

### 3.2. JSON出力モード

*   特定のコマンドライン引数（例: `--json` または `-j`）が指定された場合、全ての出力をJSON形式で行う。
*   JSON形式の出力は、プログラムによるパースを容易にする構造とする。
*   **出力内容には、既存の出力の最後に出しているJSONの内容（最終結果、議論ログなど）を含める。**
*   **エラー情報など現状のJSONに含まれない情報を含めたい場合の仕様は別途必要になったら策定する。**
*   JSONのスキーマは明確に定義する（後続タスクで詳細化）。

## 4. 非機能要件

*   **パフォーマンス**: 出力モードの切り替えによる顕著なパフォーマンス劣化がないこと。
*   **互換性**: 既存のCLI利用方法に影響を与えないこと（デフォルトモードの維持）。
*   **エラーハンドリング**: JSONモードでもエラー発生時には適切なエラーメッセージをJSON形式で出力するか、標準エラー出力に従来通り出力するかを検討する。

## 5. 実装対象ファイル

*   `src/index.ts` (CLIのエントリーポイント)
*   `src/agent.ts` (コンソールログ出力の調整)
*   `scripts/ab_test_runner.py` (JSON出力の利用例)

## 6. 今後の検討事項

*   JSON出力の具体的なスキーマ定義。
*   エラー出力の扱い（JSONモードでのエラーメッセージのJSON化の要否）。